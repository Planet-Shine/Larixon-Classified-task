(function(){var global={},ui={},types={};!function(e,n,t){function o(e,n){return typeof e===n}function s(){var e,n,t,s,a,i,r;for(var l in c)if(c.hasOwnProperty(l)){if(e=[],n=c[l],n.name&&(e.push(n.name.toLowerCase()),n.options&&n.options.aliases&&n.options.aliases.length))for(t=0;t<n.options.aliases.length;t++)e.push(n.options.aliases[t].toLowerCase());for(s=o(n.fn,"function")?n.fn():n.fn,a=0;a<e.length;a++)i=e[a],r=i.split("."),1===r.length?Modernizr[r[0]]=s:(!Modernizr[r[0]]||Modernizr[r[0]]instanceof Boolean||(Modernizr[r[0]]=new Boolean(Modernizr[r[0]])),Modernizr[r[0]][r[1]]=s),f.push((s?"":"no-")+r.join("-"))}}function a(e){var n=u.className,t=Modernizr._config.classPrefix||"";if(p&&(n=n.baseVal),Modernizr._config.enableJSClass){var o=new RegExp("(^|\\s)"+t+"no-js(\\s|$)");n=n.replace(o,"$1"+t+"js$2")}Modernizr._config.enableClasses&&(n+=" "+t+e.join(" "+t),p?u.className.baseVal=n:u.className=n)}function i(){return"function"!=typeof n.createElement?n.createElement(arguments[0]):p?n.createElementNS.call(n,"http://www.w3.org/2000/svg",arguments[0]):n.createElement.apply(n,arguments)}function r(){var e=n.body;return e||(e=i(p?"svg":"body"),e.fake=!0),e}function l(e,t,o,s){var a,l,f,c,d="modernizr",p=i("div"),h=r();if(parseInt(o,10))for(;o--;)f=i("div"),f.id=s?s[o]:d+(o+1),p.appendChild(f);return a=i("style"),a.type="text/css",a.id="s"+d,(h.fake?h:p).appendChild(a),h.appendChild(p),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(n.createTextNode(e)),p.id=d,h.fake&&(h.style.background="",h.style.overflow="hidden",c=u.style.overflow,u.style.overflow="hidden",u.appendChild(h)),l=t(p,e),h.fake?(h.parentNode.removeChild(h),u.style.overflow=c,u.offsetHeight):p.parentNode.removeChild(p),!!l}var f=[],c=[],d={_version:"3.3.1",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,n){var t=this;setTimeout(function(){n(t[e])},0)},addTest:function(e,n,t){c.push({name:e,fn:n,options:t})},addAsyncTest:function(e){c.push({name:null,fn:e})}},Modernizr=function(){};Modernizr.prototype=d,Modernizr=new Modernizr;var u=n.documentElement,p="svg"===u.nodeName.toLowerCase(),h=d._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];d._prefixes=h;var m=d.testStyles=l;Modernizr.addTest("touchevents",function(){var t;if("ontouchstart"in e||e.DocumentTouch&&n instanceof DocumentTouch)t=!0;else{var o=["@media (",h.join("touch-enabled),("),"heartz",")","{#modernizr{top:9px;position:absolute}}"].join("");m(o,function(e){t=9===e.offsetTop})}return t}),s(),a(f),delete d.addTest,delete d.addAsyncTest;for(var v=0;v<Modernizr._q.length;v++)Modernizr._q[v]();e.Modernizr=Modernizr}(window,document);var EventEmitter=function(){"use strict";var domain;function EventHandlers(){}EventHandlers.prototype=Object.create(null);function EventEmitter(){EventEmitter.init.call(this)}EventEmitter.EventEmitter=EventEmitter;EventEmitter.usingDomains=false;EventEmitter.prototype.domain=undefined;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;var defaultMaxListeners=10;Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:true,get:function(){return defaultMaxListeners},set:function(arg){console;defaultMaxListeners=arg}});EventEmitter.init=function(){this.domain=null;if(EventEmitter.usingDomains){domain=domain||require("domain");if(domain.active&&!(this instanceof domain.Domain)){this.domain=domain.active}}if(!this._events||this._events===Object.getPrototypeOf(this)._events){this._events=new EventHandlers;this._eventsCount=0}this._maxListeners=this._maxListeners||undefined};EventEmitter.prototype.setMaxListeners=function setMaxListeners(n){if(typeof n!=="number"||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');this._maxListeners=n;return this};function $getMaxListeners(that){if(that._maxListeners===undefined)return EventEmitter.defaultMaxListeners;return that._maxListeners}EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return $getMaxListeners(this)};function emitNone(handler,isFn,self){if(isFn)handler.call(self);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self)}}function emitOne(handler,isFn,self,arg1){if(isFn)handler.call(self,arg1);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self,arg1)}}function emitTwo(handler,isFn,self,arg1,arg2){if(isFn)handler.call(self,arg1,arg2);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self,arg1,arg2)}}function emitThree(handler,isFn,self,arg1,arg2,arg3){if(isFn)handler.call(self,arg1,arg2,arg3);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self,arg1,arg2,arg3)}}function emitMany(handler,isFn,self,args){if(isFn)handler.apply(self,args);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].apply(self,args)}}EventEmitter.prototype.emit=function emit(type){var er,handler,len,args,i,events,domain;var needDomainExit=false;var doError=type==="error";events=this._events;if(events)doError=doError&&events.error==null;else if(!doError)return false;domain=this.domain;if(doError){er=arguments[1];if(domain){if(!er)er=new Error('Uncaught, unspecified "error" event');er.domainEmitter=this;er.domain=domain;er.domainThrown=false;domain.emit("error",er)}else if(er instanceof Error){throw er}else{var err=new Error('Uncaught, unspecified "error" event. ('+er+")");err.context=er;throw err}return false}handler=events[type];if(!handler)return false;if(domain&&this!==process){domain.enter();needDomainExit=true}var isFn=typeof handler==="function";len=arguments.length;switch(len){case 1:emitNone(handler,isFn,this);break;case 2:emitOne(handler,isFn,this,arguments[1]);break;case 3:emitTwo(handler,isFn,this,arguments[1],arguments[2]);break;case 4:emitThree(handler,isFn,this,arguments[1],arguments[2],arguments[3]);break;default:args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];emitMany(handler,isFn,this,args)}if(needDomainExit)domain.exit();return true};function _addListener(target,type,listener,prepend){var m;var events;var existing;if(typeof listener!=="function")throw new TypeError('"listener" argument must be a function');events=target._events;if(!events){events=target._events=new EventHandlers;target._eventsCount=0}else{if(events.newListener){target.emit("newListener",type,listener.listener?listener.listener:listener);events=target._events}existing=events[type]}if(!existing){existing=events[type]=listener;++target._eventsCount}else{if(typeof existing==="function"){existing=events[type]=prepend?[listener,existing]:[existing,listener]}else{if(prepend){existing.unshift(listener)}else{existing.push(listener)}}if(!existing.warned){m=$getMaxListeners(target);if(m&&m>0&&existing.length>m){existing.warned=true;var w=new Error("Possible EventEmitter memory leak detected. "+existing.length+" "+type+"listeners added."+"Use emitter.setMaxListeners() to increase limit");w.name="Warning";w.emitter=target;w.type=type;w.count=existing.length;process.emitWarning(w)}}}return target}EventEmitter.prototype.addListener=function addListener(type,listener){return _addListener(this,type,listener,false)};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function prependListener(type,listener){return _addListener(this,type,listener,true)};function _onceWrap(target,type,listener){var fired=false;function g(){target.removeListener(type,g);if(!fired){fired=true;listener.apply(target,arguments)}}g.listener=listener;return g}EventEmitter.prototype.once=function once(type,listener){if(typeof listener!=="function")throw new TypeError('"listener" argument must be a function');this.on(type,_onceWrap(this,type,listener));return this};EventEmitter.prototype.prependOnceListener=function prependOnceListener(type,listener){if(typeof listener!=="function")throw new TypeError('"listener" argument must be a function');this.prependListener(type,_onceWrap(this,type,listener));return this};EventEmitter.prototype.removeListener=function removeListener(type,listener){var list,events,position,i,originalListener;if(typeof listener!=="function")throw new TypeError('"listener" argument must be a function');events=this._events;if(!events)return this;list=events[type];if(!list)return this;if(list===listener||list.listener&&list.listener===listener){if(--this._eventsCount===0)this._events=new EventHandlers;else{delete events[type];if(events.removeListener)this.emit("removeListener",type,list.listener||listener)}}else if(typeof list!=="function"){position=-1;for(i=list.length;i-- >0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){originalListener=list[i].listener;position=i;break}}if(position<0)return this;if(list.length===1){list[0]=undefined;if(--this._eventsCount===0){this._events=new EventHandlers;return this}else{delete events[type]}}else{spliceOne(list,position)}if(events.removeListener)this.emit("removeListener",type,originalListener||listener)}return this};EventEmitter.prototype.removeAllListeners=function removeAllListeners(type){var listeners,events;events=this._events;if(!events)return this;if(!events.removeListener){if(arguments.length===0){this._events=new EventHandlers;this._eventsCount=0}else if(events[type]){if(--this._eventsCount===0)this._events=new EventHandlers;else delete events[type]}return this}if(arguments.length===0){var keys=Object.keys(events);for(var i=0,key;i<keys.length;++i){key=keys[i];if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events=new EventHandlers;this._eventsCount=0;return this}listeners=events[type];if(typeof listeners==="function"){this.removeListener(type,listeners)}else if(listeners){do{this.removeListener(type,listeners[listeners.length-1])}while(listeners[0])}return this};EventEmitter.prototype.listeners=function listeners(type){var evlistener;var ret;var events=this._events;if(!events)ret=[];else{evlistener=events[type];if(!evlistener)ret=[];else if(typeof evlistener==="function")ret=[evlistener];else ret=arrayClone(evlistener,evlistener.length)}return ret};EventEmitter.listenerCount=function(emitter,type){if(typeof emitter.listenerCount==="function"){return emitter.listenerCount(type)}else{return listenerCount.call(emitter,type)}};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(type){var events=this._events;if(events){var evlistener=events[type];if(typeof evlistener==="function"){return 1}else if(evlistener){return evlistener.length}}return 0}EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function spliceOne(list,index){for(var i=index,k=i+1,n=list.length;k<n;i+=1,k+=1)list[i]=list[k];list.pop()}function arrayClone(arr,i){var copy=new Array(i);while(i--)copy[i]=arr[i];return copy}return EventEmitter}();var domInterface=function(){"use strict";var domInterface={},isTouch=Modernizr.touchevents;domInterface.getIndexOfElementContains=function(elements,target,className){var index,length=elements.length,capturedByClass;for(index=0;index<length;index+=1){capturedByClass=elements[index].querySelector("."+className);if(capturedByClass===target){break}}return index};domInterface.getElementFormHtml=function(html){var element=document.createElement("div");element.innerHTML=html;return element.firstChild};domInterface.appendByIndex=function(listBox,index,itemHtml){var item,nextSibling;if(!listBox.childNodes.length){listBox.innerHTML=itemHtml}else{nextSibling=listBox.childNodes[index];item=domInterface.getElementFormHtml(itemHtml);if(nextSibling){listBox.insertBefore(item,nextSibling)}else{listBox.appendChild(item)}}};domInterface.getIndexOf=function(element){var index=0;while((element=element.previousSibling)!==null){index+=1}return index};domInterface.removeClass=function(element,removeClass){if(domInterface.hasClass(element,removeClass)){element.className=element.className.replace(removeClass,"").trim()}};domInterface.addClass=function(element,addClass){if(!domInterface.hasClass(element,addClass)){element.className+=" "+addClass}};domInterface.toggleClass=function(element,toggleClass){var currentClass=element.className,toggleClassReg=new RegExp(toggleClass),newClass;if(domInterface.hasClass(element,toggleClass)){newClass=currentClass.replace(toggleClassReg,"").trim()}else{newClass=(currentClass+" "+toggleClass).trim()}element.className=newClass};domInterface.hasClass=function(element,className){var classNameReg=new RegExp("(:?\\s|^)"+className+"(:?\\s|$)");return classNameReg.test(element.className)};domInterface.getClosestByClass=function(element,className){while(element){if(domInterface.hasClass(element,className)){break}element=element.parentNode}return element};domInterface.getClosestByElement=function(element,factorElement){while(element){if(element===factorElement){break}element=element.parentNode}return element};domInterface.onClick=function(element,callback){if(isTouch){(function(){var target=null;element.addEventListener("touchstart",function(event){target=event.target},false);element.addEventListener("touchend",function(event){if(event.target===target){callback(event)}target=null},false)})()}else{element.addEventListener("click",callback,false)}};domInterface.onOutsideClick=function(element,callback){if(isTouch){(function(){var target=null;document.addEventListener("touchstart",function(event){target=event.target},false);document.addEventListener("touchend",function(event){if(event.target===target&&!domInterface.getClosestByElement(target,element)){callback(event)}target=null},false)})()}else{document.addEventListener("click",function(event){var target=event.target;if(!domInterface.getClosestByElement(target,element)){callback(event)}},false)}};return domInterface}();var dataTypes=[];dataTypes.push({caption:"Contacts",name:"contacts",titleBy:"name",structure:[{caption:"Id",name:"id",type:"integer"},{caption:"Avatar",name:"avatar",type:"avatarUri"},{caption:"Name",name:"name",type:"person"},{caption:"Phone",name:"phone",type:"phone"},{caption:"Email",name:"email",type:"email"},{caption:"Address",name:"address",type:"longString"}]});dataTypes.push({caption:"Persons",name:"persons",titleBy:"name",structure:[{caption:"Id",name:"id",type:"integer"},{caption:"Avatar",name:"avatar",type:"avatarUri"},{caption:"Name",name:"name",type:"person"},{caption:"Phone",name:"phone",type:"phone"},{caption:"Email",name:"email",type:"email"},{caption:"Birthday",name:"birthday",type:"date"}]});dataTypes.push({caption:"Deals",name:"deals",titleBy:"title",structure:[{caption:"Id",name:"id",type:"integer"},{caption:"Avatar",name:"avatar",type:"avatarUri"},{caption:"Title",name:"title",type:"mediumString"},{caption:"Description",name:"description",type:"text"},{caption:"Company",name:"company",type:"mediumString"},{caption:"Email",name:"email",type:"email"},{caption:"Phone",name:"phone",type:"phone"}]});dataTypes.push({caption:"Events",name:"events",titleBy:"title",structure:[{caption:"Id",name:"id",type:"integer"},{caption:"Avatar",name:"avatar",type:"avatarUri"},{caption:"Title",name:"title",type:"mediumString"},{caption:"Time",name:"time",type:"time"},{caption:"Address",name:"address",type:"longString"}]});var initializingData={};initializingData["contacts"]=[{id:0,avatar:"https://c2.staticflickr.com/4/3117/3175014052_7484da1205_z.jpg",name:"Petr",phone:"+7 951 505-40-28",email:"petr@yandex.ru",address:"Lenina street, 1"},{id:1,avatar:"https://c2.staticflickr.com/4/3262/3175014554_db597bbb73_z.jpg",name:"Ivan",phone:"+7 985 450-20-75",email:"ivan@yandex.ru",address:"Lenina street, 2"},{id:2,avatar:"https://c2.staticflickr.com/4/3670/8813562512_229f5cf24a_z.jpg",name:"Vasiliy",phone:"+7 999 987-95-02",email:"vasiliy@yandex.ru",address:"Lenina street, 3"},{id:3,avatar:"https://c1.staticflickr.com/9/8440/7787237516_b46aa5fabb_c.jpg",name:"Grigoriy",phone:"+7 979 654-78-15",email:"grigoriy@yandex.ru",address:"Lenina street, 4"},{id:4,avatar:"https://c2.staticflickr.com/4/3404/3449526371_0454515b13_z.jpg",name:"Aleksandr",phone:"+7 259 678-15-79",email:"aleksandr@yandex.ru",address:"Lenina street, 5"}];initializingData["persons"]=[{id:0,avatar:"https://c2.staticflickr.com/2/1032/3175022066_57fce505be_z.jpg",name:"Petr",phone:"+7 958 958-65-87",email:"petr@yandex.ru",birthday:"12/05/2000"},{id:1,avatar:"https://c1.staticflickr.com/3/2528/3751624573_08815f8950_z.jpg",name:"Ivan",phone:"+7 587 675-78-99",email:"ivan@yandex.ru",birthday:"12/05/1998"},{id:2,avatar:"https://c2.staticflickr.com/4/3262/3175014554_db597bbb73_z.jpg",name:"Leonid",phone:"+7 158 987-45-63",email:"leonid@yandex.ru",birthday:"12/08/1998"}];initializingData["deals"]=[{id:0,avatar:"https://c2.staticflickr.com/4/3602/3450323658_ab5961a0aa_z.jpg",title:"Coal delivery",description:"Coal delivery on 15.05.2016",company:"Ltd. Good Coal",email:"good-coal@yandex.ru",phone:"+7 950 958-40-50"},{id:1,avatar:"https://c1.staticflickr.com/3/2491/3751647375_4695b378de_z.jpg",title:"Goods delivery",description:"Goods delivery on 15.06.2016",company:"Ltd. Good Goods",email:"good-goods@yandex.ru",phone:"+7 955 258-85-25"},{id:2,avatar:"https://c1.staticflickr.com/3/2443/3752426198_ebe03fa615_z.jpg",title:"Metal delivery",description:"Metal delivery on 15.07.2016",company:"Ltd. Good Metal",email:"good-metal@yandex.ru",phone:"+7 999 948-68-78"},{id:3,avatar:"https://c2.staticflickr.com/2/1032/3175022066_57fce505be_z.jpg",title:"Food delivery",description:"Food delivery on 15.08.2016",company:"Ltd. Good Coal",email:"food-coal@yandex.ru",phone:"+7 798 654-27-35"}];initializingData["events"]=[{id:0,avatar:"https://c1.staticflickr.com/3/2528/3751624573_08815f8950_z.jpg",title:"Petr Birtday",time:"12/05/2015 12:30",address:"Lenina street, 1"},{id:1,avatar:"https://c2.staticflickr.com/4/3117/3175014052_7484da1205_z.jpg",title:"Ivan Birtday",time:"13/06/2015 17:30",address:"Lenina street, 2"},{id:2,avatar:"https://c2.staticflickr.com/4/3670/8813562512_229f5cf24a_z.jpg",title:"Leonid Birtday",time:"14/06/2015 18:30",address:"Lenina street, 3"},{id:3,avatar:"https://c1.staticflickr.com/9/8440/7787237516_b46aa5fabb_c.jpg",title:"Petrov marriage ceremony",time:"15/07/2015 12:00",address:"Lenina street, 4"},{id:4,avatar:"https://c2.staticflickr.com/4/3404/3449526371_0454515b13_z.jpg",title:"Ivanov marriage ceremony",time:"18/08/2015 22:30",address:"Lenina street, 5"},{id:5,avatar:"https://c2.staticflickr.com/4/3602/3450323658_ab5961a0aa_z.jpg",title:"Dog buy",time:"19/01/2015 11:20",address:"Lenina street, 6"},{id:6,avatar:"https://c1.staticflickr.com/3/2491/3751647375_4695b378de_z.jpg",title:"Room clean",time:"10/12/2015 15:40",address:"Lenina street, 7"},{id:7,avatar:"https://c1.staticflickr.com/3/2443/3752426198_ebe03fa615_z.jpg",title:"Road race",time:"15/07/2015 16:10",address:"Lenina street, 8"}];ui.Button=function(element,properties){"use strict";properties=properties||{};this.element=element;this.properties=properties;this.render();this.button=element.querySelector(".button");this.element.parentNode.replaceChild(this.button,this.element);this.element=this.button;this.attachHandlers()};ui.Button.prototype=Object.create(EventEmitter.prototype);ui.Button.prototype.constructor=ui.Select;ui.Button.prototype.button=null;ui.Button.prototype.hiddenClass="button_hidden";ui.Button.prototype.show=function(){"use strict";domInterface.removeClass(this.button,this.hiddenClass)};ui.Button.prototype.hide=function(){"use strict";domInterface.addClass(this.button,this.hiddenClass)};ui.Button.prototype.onClickHandler=function(){"use strict";this.emit("clicked")};ui.Button.prototype.attachHandlers=function(){"use strict";this.onClickHandler=this.onClickHandler.bind(this);domInterface.onClick(this.button,this.onClickHandler)};ui.Button.prototype.render=function(){"use strict";var caption=this.properties.caption||"",mainTemplate=ui.Button.templates.main,html=mainTemplate.replace("{{caption}}",caption);this.element.innerHTML=html};ui.Button.templates={main:'<button class="button">'+'<div class="button__caption">{{caption}}</div>'+"</button>"};ui.DetailedList=function(element,properties){"use strict";properties=properties||{};this.element=element;this.properties=properties;this.model=properties["model"]||null;this.preBindHandlers();this.render();this.attachHandlers();this.attachDomHandlers()};ui.DetailedList.prototype=Object.create(EventEmitter.prototype);ui.DetailedList.prototype.constructor=ui.DetailedList;ui.DetailedList.prototype.removeItemClass="list__remove-item";ui.DetailedList.prototype.detailsButtonClass="list__detail-button";ui.DetailedList.prototype.listItemClass="list__item";ui.DetailedList.prototype.detailsClosedClass="list__item_details-closed";ui.DetailedList.prototype.listItemsBoxClass="list__items-box";ui.DetailedList.prototype.hiddenClass="list_hidden";ui.DetailedList.prototype.element=null;ui.DetailedList.prototype.properties=null;ui.DetailedList.prototype.model=null;ui.DetailedList.templates={main:'<div class="list list_hidden">'+'<ul class="list__items-box">{{listItems}}</ul>'+"</div>",li:'<li class="list__item list__item_details-closed">'+'<span class="list__item-caption">{{listItemCaption}}</span>'+'<span class="list__remove-item">✕</span>'+'<button class="button list__detail-button">'+'<div class="button__caption">'+"Detail"+"</div>"+"</button>"+'<ul class="list__detail">'+"{{detailsList}}"+"</ul>"+"</li>",detailItem:'<li class="list__detail-item">{{caption}}: {{value}}</li>',detailAvararItem:'<li class="list__detail-item">{{caption}} : <img class="list__detail-item-image" src="{{value}}" /></li>'};ui.DetailedList.prototype.getList=function(){"use strict";return this.element.querySelector(".list")};ui.DetailedList.prototype.hide=function(){"use strict";domInterface.addClass(this.getList(),this.hiddenClass)};ui.DetailedList.prototype.show=function(){"use strict";domInterface.removeClass(this.getList(),this.hiddenClass)};ui.DetailedList.prototype.setModel=function(newModel){"use strict";if(this.model!==newModel){this.model=newModel;this.render();this.attachHandlers()}};ui.DetailedList.prototype.preBindHandlers=function(){"use strict";this.onAddItemHandler=this.onAddItemHandler.bind(this);this.onDeleteItemHandler=this.onDeleteItemHandler.bind(this);this.removeItemClickHandler=this.removeItemClickHandler.bind(this);this.showDetailsClickHandler=this.showDetailsClickHandler.bind(this);this.getItemHtml=this.getItemHtml.bind(this)};ui.DetailedList.prototype.attachHandlers=function(){"use strict";var model=this.model;if(model){model.removeListener("deleteItem",this.onDeleteItemHandler);model.removeListener("addItem",this.onAddItemHandler);model.on("deleteItem",this.onDeleteItemHandler);model.on("addItem",this.onAddItemHandler)}};ui.DetailedList.prototype.removeItemClickHandler=function(event){"use strict";var target=event.target,listItem=domInterface.getClosestByClass(target,this.listItemClass),index=domInterface.getIndexOf(listItem);this.model.removeItemByIndex(index)};ui.DetailedList.prototype.showDetailsClickHandler=function(event){"use strict";var target=event.target,listItem=domInterface.getClosestByClass(target,this.listItemClass);domInterface.toggleClass(listItem,this.detailsClosedClass)};ui.DetailedList.prototype.attachDomHandlers=function(){"use strict";var self=this;domInterface.onClick(this.element,function(event){var target=event.target;if(domInterface.getClosestByClass(target,self.removeItemClass)){self.removeItemClickHandler(event)}else if(domInterface.getClosestByClass(target,self.detailsButtonClass)){self.showDetailsClickHandler(event)}})};ui.DetailedList.prototype.getItemsBox=function(){"use strict";return this.element.querySelector("."+this.listItemsBoxClass)};ui.DetailedList.prototype.onAddItemHandler=function(event){"use strict";var index=event.index,itemData=event.itemData;domInterface.appendByIndex(this.getItemsBox(),index,this.getItemHtml(itemData))};ui.DetailedList.prototype.onDeleteItemHandler=function(event){"use strict";var index=event.index,itemsBox=this.getItemsBox();itemsBox.removeChild(itemsBox.childNodes[index])};ui.DetailedList.prototype.getItemHtml=function(itemData){"use strict";var templates=ui.DetailedList.templates,model=this.model,titleBy=model.getTitleBy(),detailAvararItem,liHtml,detailsList="";liHtml=templates.li;liHtml=liHtml.replace("{{listItemCaption}}",itemData[titleBy]);Object.keys(itemData).forEach(function(key,index){var caption=model.getCaptionByName(key),detailItem;if(key!=="id"){if(model.getTypeByName(key)==="avatarUri"){detailItem=templates.detailAvararItem}else{detailItem=templates.detailItem}detailItem=detailItem.replace("{{caption}}",caption);detailItem=detailItem.replace("{{value}}",itemData[key]);detailsList+=detailItem}});liHtml=liHtml.replace("{{detailsList}}",detailsList);return liHtml};ui.DetailedList.prototype.render=function(){"use strict";var templates=ui.DetailedList.templates,data,model,listItemsHtml,html;html=templates.main;listItemsHtml="";if(this.model){model=this.model;data=model.getListData();if(data instanceof Array){listItemsHtml=data.map(this.getItemHtml).join("")}}html=html.replace("{{listItems}}",listItemsHtml);this.element.innerHTML=html};ui.DisplayButton=function(element,properties){"use strict";properties=properties||{};this.element=element;this.properties=properties;this.render();this.button=element.querySelector(".button");this.element.parentNode.replaceChild(this.button,this.element);this.element=this.button;this.attachHandlers()};ui.DisplayButton.prototype=Object.create(ui.Button.prototype);ui.DisplayButton.prototype.constructor=ui.DisplayButton;ui.DisplayButton.prototype.mode="show";ui.DisplayButton.prototype.hideClass="button_hide";ui.DisplayButton.prototype.showClass="button_show";ui.DisplayButton.prototype.onClickHandler=function(){"use strict";this.emit("clicked",{action:this.mode})};ui.DisplayButton.prototype.toShowMode=function(){"use strict";this.mode="show";domInterface.addClass(this.button,this.showClass);domInterface.removeClass(this.button,this.hideClass)};ui.DisplayButton.prototype.toHideMode=function(){"use strict";this.mode="hide";domInterface.addClass(this.button,this.hideClass);domInterface.removeClass(this.button,this.showClass)};ui.DisplayButton.prototype.render=function(){"use strict";var showCaption=this.properties.showCaption||"",hideCaption=this.properties.hideCaption||"",mainTemplate=ui.DisplayButton.templates.main,html=mainTemplate.replace("{{showCaption}}",showCaption);html=html.replace("{{hideCaption}}",hideCaption);this.element.innerHTML=html};ui.DisplayButton.templates={main:'<button class="button button_show">'+'<div class="button__caption button__caption-show">{{showCaption}}</div>'+'<div class="button__caption button__caption-hide">{{hideCaption}}</div>'+"</button>"};ui.Select=function(element,properties){"use strict";properties=properties||{};this.properties=properties;this.element=element;this.render();this.select=this.element.querySelector(".select");this.element.parentNode.replaceChild(this.select,this.element);this.element=this.select;this.caption=this.element.querySelector(".select__caption");this.selectedCaption=this.element.querySelector("."+this.selectedCaptionClass);this.optionList=this.element.querySelector(".select__options");this.prebindHandlers();this.attachHandlers()};ui.Select.prototype=Object.create(EventEmitter.prototype);ui.Select.prototype.constructor=ui.Select;ui.Select.prototype.value=null;ui.Select.prototype.closedClass="select_closed";ui.Select.prototype.itemClass="select__item";ui.Select.prototype.selectedCaptionClass="select__selected";ui.Select.prototype.selectedCaptionShowClass="select_shown-selected";ui.Select.prototype.defaultCaptionShowClass="select_shown-default";ui.Select.prototype.selectedItemClass="select__item_selected";ui.Select.prototype.element=null;ui.Select.prototype.select=null;ui.Select.prototype.caption=null;ui.Select.prototype.options=null;ui.Select.prototype.properties=null;ui.Select.prototype.getValue=function(){"use strict";return this.value};ui.Select.prototype.toSelectedShownMode=function(){"use strict";domInterface.addClass(this.select,this.selectedCaptionShowClass);domInterface.removeClass(this.select,this.defaultCaptionShowClass)};ui.Select.prototype.onOptionListClickHandler=function(event){"use strict";var target=event.target,closestListItem=domInterface.getClosestByClass(target,this.itemClass),selectedItem,value,oldValue;if(closestListItem){selectedItem=this.optionList.querySelector("."+this.selectedItemClass);if(selectedItem){domInterface.removeClass(selectedItem,this.selectedItemClass)}domInterface.addClass(closestListItem,this.selectedItemClass);oldValue=this.value;value=this.properties.options[domInterface.getIndexOf(closestListItem)]["value"];this.value=value;this.selectedCaption.innerHTML=closestListItem.innerHTML;this.toSelectedShownMode();this.toggleClosed();if(oldValue!==value){this.emit("changed",{oldValue:oldValue,value:value})}}};ui.Select.prototype.toggleClosed=function(){"use strict";domInterface.toggleClass(this.select,this.closedClass)};ui.Select.prototype.onCaptionClickHandler=function(){"use strict";this.toggleClosed()};ui.Select.prototype.onOutsideClickHandler=function(){"use strict";domInterface.addClass(this.select,this.closedClass)};ui.Select.prototype.prebindHandlers=function(){"use strict";this.onCaptionClickHandler=this.onCaptionClickHandler.bind(this);this.onOptionListClickHandler=this.onOptionListClickHandler.bind(this);this.onOutsideClickHandler=this.onOutsideClickHandler.bind(this)};ui.Select.prototype.attachHandlers=function(){"use strict";domInterface.onClick(this.caption,this.onCaptionClickHandler);domInterface.onClick(this.optionList,this.onOptionListClickHandler);domInterface.onOutsideClick(this.select,this.onOutsideClickHandler)};ui.Select.prototype.render=function(){"use strict";var templates=ui.Select.templates,defaultCaption=this.properties.defaultCaption||"",options=this.properties.options,html="",listItems;listItems=options.map(function(option){var li=templates.li;li=li.replace("{{caption}}",option["caption"]);return li}).join("");html+=templates.main;html=html.replace("{{defaultCaption}}",defaultCaption);html=html.replace("{{listItems}}",listItems);this.element.innerHTML=html};ui.Select.templates={main:'<div class="select select_closed select_shown-default select_medium">'+'<div class="select__caption">'+'<div class="select__selected-default">{{defaultCaption}}</div>'+'<div class="select__selected">'+"</div>"+'<div class="select__caption-icon"></div>'+"</div>"+'<ul class="select__options">{{listItems}}'+"</ul>"+"</div>",li:'<li class="select__item">{{caption}}</li>'};ui.Select.prototype.selectByItemId=function(){"use strict";return};ui.UniversalForm=function(element,properties){"use strict";var self=this;properties=properties||{};this.element=element;this.properties=properties;this.model=properties["model"]||null;types.AvatarURI.getImages(function(){self.render();self.prebindHandlers();self.form=element.querySelector(".form");self.attachHandlers();self.attachDomHandlers()})};ui.UniversalForm.prototype=Object.create(EventEmitter.prototype);ui.UniversalForm.prototype.constructor=ui.Select;ui.UniversalForm.templates={main:'<div class="form"><div class="form__only-form-fields-box">{{formFields}}</div></div>',img:'<div class="form__add-image form__add-image_сlosed form__field">'+'<div class="form__add-image-caption">{{caption}}</div>'+'<div class="form__add-current-image {{choosedClass}}">'+'<div class="form__square-figure"></div>'+'<div class="form__cycle-figure"></div>'+'<div class="form__empty-caption">+</div>'+"{{value}}</div>"+'<div class="form__add-image-popup">'+'<div class="form__add-image-popup-items">'+"<ul>{{imageList}}</ul>"+"</div>"+"</div>"+"</div>","img-value":'<img class="form__add-current-image-img" src="{{value}}" />',"img-list-item":'<li class="form__add-image-item"><img class="form__add-image-item-img" src="{{value}}" /></li>',
"img-list-item-none":'<li class="form__add-image-item form__add-image-item-none">none</li>',input:'<div class="form__input-box form__field">'+'<div class="form__input-caption">{{caption}}</div>'+'<input class="form__input" type="text" value="{{value}}" />'+"</div>",textarea:'<div class="form__textarea-box form__field">'+'<div class="form__textarea-caption">{{caption}}</div>'+'<textarea class="form__textarea">{{value}}</textarea>'+"</div>"};ui.UniversalForm.prototype.form=null;ui.UniversalForm.prototype.formInputClass="form__input";ui.UniversalForm.prototype.formTextareaClass="form__textarea";ui.UniversalForm.prototype.formFieldClass="form__field";ui.UniversalForm.prototype.addImageFieldClass="form__add-image";ui.UniversalForm.prototype.notValidClass="form__field_not-valid";ui.UniversalForm.prototype.addImageClosedClass="form__add-image_сlosed";ui.UniversalForm.prototype.imageChoosedClass="form__add-current-image_choosed";ui.UniversalForm.prototype.imagePopupClass="form__add-image-popup";ui.UniversalForm.prototype.onClickHandler=function(event){"use strict";var target=event.target;if(domInterface.getClosestByClass(target,"form__add-image")&&!domInterface.getClosestByClass(target,"form__add-image-popup")){this.toggleAvatarHandler(event)}else if(domInterface.hasClass(target,"form__add-image-item-img")||domInterface.getClosestByClass(target,"form__add-image-item-none")){this.chooseAvatarHandler(event)}};ui.UniversalForm.prototype.getFieldIndex=function(target){"use strict";var fieldIndex,fields=this.element.querySelectorAll("."+this.formFieldClass),currentField=domInterface.getClosestByClass(target,this.formFieldClass);fieldIndex=[].slice.apply(fields).indexOf(currentField);return fieldIndex};ui.UniversalForm.prototype.toggleAvatarHandler=function(event){"use strict";var target=event.target,field=domInterface.getClosestByClass(target,"form__field");domInterface.toggleClass(field,this.addImageClosedClass)};ui.UniversalForm.prototype.onKeyDownHandler=function(event){"use strict";var self=this,target=event.target,formField,fieldIndex;formField=domInterface.getClosestByClass(target,this.formFieldClass);fieldIndex=this.getFieldIndex(target);setTimeout(function(){if(self.model.isValueNew(fieldIndex,target.value)){domInterface.removeClass(formField,self.notValidClass);self.model.setValue(fieldIndex,target.value)}},0)};ui.UniversalForm.prototype.onClickOutsizeImgListHandler=function(event){"use strict";var self=this,target=event.target,fields=this.element.querySelectorAll("."+this.addImageFieldClass),closestField;fields=[].slice.apply(fields);closestField=domInterface.getClosestByClass(target,this.addImageFieldClass);if(closestField){fields.splice(fields.indexOf(closestField),1)}fields.forEach(function(field){domInterface.addClass(field,self.addImageClosedClass)})};ui.UniversalForm.prototype.chooseAvatarHandler=function(event){"use strict";var target=event.target,field=domInterface.getClosestByClass(target,"form__field"),templates=ui.UniversalForm.templates,imgValue=templates["img-value"],indexOfImage,li,lis,src,fieldIndex,imageBox,image;lis=domInterface.getClosestByClass(target,"form__add-image-popup-items").querySelectorAll(".form__add-image-item");li=domInterface.getClosestByClass(target,"form__add-image-item");indexOfImage=[].slice.apply(lis).indexOf(li);src=types.AvatarURI.images[indexOfImage]||null;this.toggleAvatarHandler(event);imageBox=field.querySelector(".form__add-current-image");image=imageBox.querySelector(".form__add-current-image-img");if(!src){domInterface.removeClass(imageBox,this.imageChoosedClass);if(image){image.parentNode.removeChild(image)}}else{domInterface.addClass(imageBox,this.imageChoosedClass);if(!image){imgValue=imgValue.replace("{{value}}",src);imgValue=domInterface.getElementFormHtml(imgValue);imageBox.appendChild(imgValue)}else{image.setAttribute("src",src)}}fieldIndex=this.getFieldIndex(target);if(this.model.isValueNew(fieldIndex,src)){domInterface.removeClass(field,this.notValidClass);this.model.setValue(fieldIndex,src)}};ui.UniversalForm.prototype.onChangeHandler=function(event){"use strict";var target=event.target,formField=domInterface.getClosestByClass(target,this.formFieldClass),fieldIndex=this.getFieldIndex(target);if(!this.model.isValidByFieldIndex(fieldIndex)){domInterface.addClass(formField,this.notValidClass)}else{domInterface.removeClass(formField,this.notValidClass)}};ui.UniversalForm.prototype.prebindHandlers=function(){"use strict";this.onClickHandler=this.onClickHandler.bind(this);this.onClickOutsizeImgListHandler=this.onClickOutsizeImgListHandler.bind(this);this.toggleAvatarHandler=this.toggleAvatarHandler.bind(this);this.chooseAvatarHandler=this.chooseAvatarHandler.bind(this);this.onKeyDownHandler=this.onKeyDownHandler.bind(this);this.onChangeHandler=this.onChangeHandler.bind(this)};ui.UniversalForm.prototype.attachDomHandlers=function(){"use strict";var self=this;domInterface.onClick(this.element,this.onClickHandler);domInterface.onOutsideClick(null,this.onClickOutsizeImgListHandler);this.element.addEventListener("keydown",this.onKeyDownHandler,false);this.element.addEventListener("change",this.onChangeHandler,false)};ui.UniversalForm.prototype.showAllNotValid=function(){"use strict";var self=this,fields=this.element.querySelectorAll("."+this.formFieldClass);fields=[].slice.apply(fields);fields.forEach(function(formField,fieldIndex){if(self.model.isValidByFieldIndex(fieldIndex)){domInterface.removeClass(formField,self.notValidClass)}else{domInterface.addClass(formField,self.notValidClass)}})};ui.UniversalForm.prototype.attachHandlers=function(){"use strict"};ui.UniversalForm.prototype.setModel=function(newModel){"use strict";var self=this;if(this.model!==newModel){types.AvatarURI.getImages(function(){self.model=newModel;self.render();self.attachHandlers()})}};ui.UniversalForm.prototype.getAvatarHtml=function(typeItem,dataItem){"use strict";var templates=ui.UniversalForm.templates,imgHtml=templates["img"],imgValue=templates["img-value"],imageList="",src=dataItem[typeItem["name"]],imageChoosedClass,images;if(src){imgValue=imgValue.replace("{{value}}",src);imageChoosedClass=this.imageChoosedClass}else{imgValue="";imageChoosedClass=""}imgHtml=imgHtml.replace("{{choosedClass}}",imageChoosedClass);imgHtml=imgHtml.replace("{{caption}}",typeItem["caption"]);imgHtml=imgHtml.replace("{{value}}",imgValue);images=types.AvatarURI.images||[];images.forEach(function(value){var imgListItemHtml=templates["img-list-item"];imageList+=imgListItemHtml.replace("{{value}}",value)});imageList+=templates["img-list-item-none"];imgHtml=imgHtml.replace("{{imageList}}",imageList);return imgHtml};ui.UniversalForm.prototype.render=function(){"use strict";var self=this,templates=ui.UniversalForm.templates,model=this.model,fieldTypeMatch={text:"textarea",integer:"input",date:"input",email:"input",longString:"input",mediumString:"input",person:"input",phone:"input",time:"input"},dataTypeStructure,dataItem,formFieldsHtml,html;html=templates.main;formFieldsHtml="";if(model){dataTypeStructure=model.getDataTypeStructure();dataItem=model.getItemData()||{};dataTypeStructure.forEach(function(typeItem){var fieldName=typeItem["name"],fieldType=typeItem["type"],itemHtml=templates[fieldTypeMatch[typeItem["type"]]],value=dataItem[fieldType]||"",caption=typeItem["caption"];if(fieldName!=="id"){if(fieldType==="avatarUri"){formFieldsHtml+=self.getAvatarHtml(typeItem,dataItem)}else{itemHtml=itemHtml.replace("{{value}}",value);itemHtml=itemHtml.replace("{{caption}}",caption);formFieldsHtml+=itemHtml}}})}html=html.replace("{{formFields}}",formFieldsHtml);this.element.innerHTML=html};var Model=function(){"use strict"};Model.prototype=Object.create(EventEmitter.prototype);Model.prototype.constructor=Model;Model.prototype.isValidList=function(targetList,type){"use strict";var self=this,result=true;targetList.forEach(function(target){result=result&&self.isValidItem(target,type)});return result};Model.prototype.isValidItem=function(target,type){"use strict";var result=true;if(type["structure"]){if(type["structure"].length!==Object.keys(target).length){result=false}else{result=type["structure"].every(function(filedDescription){var name=filedDescription["name"],filedType=filedDescription["type"],value=new typeHash[filedType](target[name]);return value.isValid()})}}else{result=new typeHash[type](target).isValid()}return result};Model.prototype.isValidStateOfItem=function(target,type){"use strict";var result={};type["structure"].forEach(function(filedDescription){var name=filedDescription["name"],filedType=filedDescription["type"],value=new typeHash[filedType](target[name]);result["name"]=value.isValid()});return result};var TypifiedListModel=function(data,dataType){"use strict";data=data||[];if(!this.isValidList(data,dataType)){data=[]}this.data=data;this.dataType=dataType};TypifiedListModel.prototype=Object.create(Model.prototype);TypifiedListModel.prototype.constructor=TypifiedListModel;TypifiedListModel.prototype.data=null;TypifiedListModel.prototype.dataType=null;TypifiedListModel.prototype.getNextId=function(){"use strict";var ids=this.data.map(function(item){return item.id}),maxId=ids.length?Math.max.apply(null,ids):0;return maxId+1};TypifiedListModel.prototype.getListData=function(){"use strict";return this.data};TypifiedListModel.prototype.getTypeByName=function(name){"use strict";var structure=this.dataType.structure,length=structure.length,index;for(index=0;index<length;index+=1){if(structure[index]["name"]===name){return structure[index]["type"]}}};TypifiedListModel.prototype.getCaptionByName=function(targetName){"use strict";var result=this.dataType["structure"].filter(function(item){return item["name"]===targetName});if(result&&result.length){return result[0]["caption"]}};TypifiedListModel.prototype.getTitleBy=function(){"use strict";return this.dataType["titleBy"]};TypifiedListModel.prototype.addNewElement=function(newElement,index){"use strict";var data=this.data;if(this.isValidItem(newElement,this.dataType)){if(typeof index!=="number"){index=data.length}data.splice(index,0,newElement);this.emit("addItem",{index:index,itemData:newElement})}};TypifiedListModel.prototype.removeItemByIndex=function(index){"use strict";this.data.splice(index,1);this.emit("deleteItem",{index:index})};var TypifiedItemModel=function(data,dataType,relatedListModel){"use strict";data=data||{};if(!this.isValidItem(data,dataType)){data={}}this.dataType=dataType;this.relatedListModel=relatedListModel;if(data["id"]===undefined){data["id"]=relatedListModel.getNextId()}this.data=data};TypifiedItemModel.prototype=Object.create(Model.prototype);TypifiedItemModel.prototype.constructor=TypifiedItemModel;TypifiedItemModel.prototype.relatedListModel=null;TypifiedItemModel.prototype.getData=function(){"use strict";return this.data};TypifiedItemModel.prototype.isValidByFieldIndex=function(fieldIndex){"use strict";var typeIndex=this.getTypeIndexByFieldIndex(fieldIndex),fieldDescription=this.dataType.structure[typeIndex],value=this.data[fieldDescription["name"]];return this.isValidItem(value,fieldDescription["type"])};TypifiedItemModel.prototype.getDataTypeStructure=function(){"use strict";return this.dataType["structure"]};TypifiedItemModel.prototype.getItemData=function(){"use strict";return this.data};TypifiedItemModel.prototype.isValueNew=function(fieldIndex,value){"use strict";return this.data[this.dataType.structure[this.getTypeIndexByFieldIndex(fieldIndex)]["name"]]!==value};TypifiedItemModel.prototype.getTypeIndexByFieldIndex=function(fieldIndex){"use strict";var typifiedStructure=this.dataType.structure,length=typifiedStructure.length,index;for(index=0;index<length;index+=1){if(typifiedStructure[index]["name"]==="id"&&index<=fieldIndex){fieldIndex+=1;break}if(index>fieldIndex){break}}return fieldIndex};TypifiedItemModel.prototype.setValue=function(fieldIndex,value){"use strict";this.data[this.dataType.structure[this.getTypeIndexByFieldIndex(fieldIndex)]["name"]]=value};TypifiedItemModel.prototype.isValid=function(){"use strict";return this.isValidItem(this.data,this.dataType)};TypifiedItemModel.prototype.getValidState=function(){"use strict";return this.isValidStateOfItem(this.data,this.dataType)};var imagesType={caption:"Images",name:"image",titleBy:"image",structure:[{caption:"Image",name:"image",type:"avatarUri"}]};var dataTypesHash=function(){"use strict";var dataTypesHash={};dataTypes.forEach(function(item){dataTypesHash[item["name"]]=item});return dataTypesHash}();types.AvatarURI=function(value){"use strict";this.value=value};types.AvatarURI.typeName="avatarUri";types.AvatarURI.prototype.testRegular=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/;types.AvatarURI.prototype.value=null;types.AvatarURI.getImages=function(callback){"use strict";var XHR="onload"in new XMLHttpRequest?XMLHttpRequest:XDomainRequest,xhr=new XHR;if(types.AvatarURI.images){callback(types.AvatarURI.images)}else{xhr.open("GET","http://somon-front.pakhomov.im/front_test_4321/",true);xhr.onload=function(){types.AvatarURI.images=JSON.parse(this.responseText);callback(types.AvatarURI.images)};xhr.onerror=function(){types.AvatarURI.images=[];callback(types.AvatarURI.images)};xhr.send()}};types.AvatarURI.images=null;types.AvatarURI.prototype.isValid=function(){"use strict";return this.testRegular.test(this.value)&&this.value&&this.value.length};types.Date=function(value){"use strict";this.value=value};types.Date.typeName="date";types.Date.prototype.parseRegular=/^(\d+)\/(\d+)\/(\d+)$/;types.Date.prototype.value=null;types.Date.prototype.isValid=function(){"use strict";var result=false,parseRegular=this.parseRegular,matchResult,date;if(!(this.value&&this.value.length)){return false}matchResult=this.value.match(parseRegular);if(matchResult!==null){date=matchResult.slice(1).map(function(value){return parseInt(value,10)});date=new Date(date[2],date[1],date[1]);if(Object.prototype.toString.call(date)==="[object Date]"){result=true}}return result};types.Email=function(value){"use strict";this.value=value};types.Email.typeName="email";types.Email.prototype.testRegular=/^[a-zA-Z0-9\._\-]+@[a-zA-Z0-9\-]+\.(?:[a-zA-Z0-9\-\.]+)+$/i;types.Email.prototype.maxLength=100;types.Email.prototype.value=null;types.Email.prototype.isValid=function(){"use strict";return this.testRegular.test(this.value)&&this.value&&this.value.length;this.value.length<=this.maxLength};types.Integer=function(value){"use strict";this.value=value};types.Integer.typeName="integer";types.Integer.prototype.value=null;types.Integer.prototype.isValid=function(){"use strict";return parseInt(this.value,10)===this.value};types.LongString=function(value){"use strict";this.value=value};types.LongString.typeName="longString";types.LongString.prototype.value=null;types.LongString.prototype.maxLength=200;types.LongString.prototype.isValid=function(){"use strict";return typeof this.value==="string"&&this.value.length&&this.value.length<=this.maxLength};types.MediumString=function(value){"use strict";this.value=value};types.MediumString.typeName="mediumString";types.MediumString.prototype.value=null;types.MediumString.prototype.maxLength=70;types.MediumString.prototype.isValid=function(){"use strict";return typeof this.value==="string"&&this.value.length&&this.value.length<=this.maxLength};types.Person=function(value){"use strict";this.value=value};types.Person.typeName="person";types.Person.prototype.value=null;types.Person.prototype.maxLength=50;types.Person.prototype.testRegular=/^[\wА-Яа-я\s]+$/;types.Person.prototype.isValid=function(){"use strict";return this.testRegular.test(this.value)&&this.value&&this.value.length&&this.value.length<=this.maxLength};types.Phone=function(value){"use strict";this.value=value};types.Phone.typeName="phone";types.Phone.prototype.testRegular=/^(\+\d{1,2}\s)?\(?\d{3}\)?[\s.-]\d{3}[\s.-]\d{2}[\s.-]\d{2}$/;types.Phone.prototype.value=null;types.Phone.prototype.isValid=function(){"use strict";return this.testRegular.test(this.value)&&this.value&&this.value.length};types.Text=function(value){"use strict";this.value=value};types.Text.typeName="text";types.Text.prototype.maxLength=500;types.Text.prototype.value=null;types.Text.prototype.isValid=function(){"use strict";return typeof this.value==="string"&&this.value&&this.value.length&&this.value.length<=this.maxLength};types.Time=function(value){"use strict";this.value=value};types.Time.typeName="time";types.Time.prototype.parseRegular=/^(\d+)\/(\d+)\/(\d+) (\d+):(\d+)$/;types.Time.prototype.value=null;types.Time.prototype.isValid=function(){"use strict";var result=false,parseRegular=this.parseRegular,matchResult,date;if(!(this.value&&this.value.length)){return false}matchResult=this.value.match(parseRegular);if(matchResult!==null){date=matchResult.slice(1).map(function(value){return parseInt(value,10)});date=new Date(date[2],date[1],date[1],date[3],date[4]);if(Object.prototype.toString.call(date)==="[object Date]"){result=true}}return result&&this.value&&this.value.length};var typeHash=function(){"use strict";var typeHash={};Object.keys(types).forEach(function(key){var type=types[key],typeName=type.typeName;typeHash[typeName]=type});return typeHash}();(function(){"use strict";function ready(){var detailedList,listModel,itemModel,addButton,showListButton,dataTypeSelect,selectDataTypes,universalForm,currentDataType,newItemHash={},listData=initializingData;global.appData={newItemHash:newItemHash,listData:listData};selectDataTypes=dataTypes.map(function(typeItem){return{value:typeItem["name"],caption:typeItem["caption"]}});dataTypeSelect=new ui.Select(document.querySelector(".data-type-select"),{options:selectDataTypes,defaultCaption:"Choose data type"});function applyItemEdit(){itemModel=new TypifiedItemModel(newItemHash[currentDataType],dataTypesHash[currentDataType],listModel);universalForm.setModel(itemModel)}function clearItemEdit(){newItemHash[currentDataType]={};applyItemEdit()}function createDetailedList(){detailedList=new ui.DetailedList(document.querySelector(".current-data-type-list"),{model:listModel})}function updateDetailedList(){detailedList.setModel(listModel)}dataTypeSelect.on("changed",function(event){var value=event.value;currentDataType=value;listModel=new TypifiedListModel(listData[value],dataTypesHash[value]);showListButton.toShowMode();if(value){showListButton.show();addButton.show()}else{showListButton.hide();addButton.hide()}if(detailedList){detailedList.hide()}if(!newItemHash[currentDataType]){newItemHash[currentDataType]={}}applyItemEdit()});addButton=new ui.Button(document.querySelector(".add-record-button"),{caption:"Add"});addButton.on("clicked",function(){var data;if(itemModel.isValid()){data=itemModel.getItemData();listModel.addNewElement(data);clearItemEdit()}else{universalForm.showAllNotValid()}});addButton.hide();showListButton=new ui.DisplayButton(document.querySelector(".show-list-button"),{showCaption:"Show list",hideCaption:"Hide list"});showListButton.on("clicked",function(event){if(event["action"]==="show"){if(!detailedList){createDetailedList()}updateDetailedList();detailedList.show();showListButton.toHideMode()}else if(event["action"]==="hide"){detailedList.hide();showListButton.toShowMode()}});showListButton.hide();universalForm=new ui.UniversalForm(document.querySelector(".typified-current-data-type-form"),{model:null})}document.addEventListener("DOMContentLoaded",ready)})()})();